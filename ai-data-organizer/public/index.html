<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI æ•¸æ“šæ•´ç†ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto p-8">
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">ğŸ¤– AI æ•¸æ“šæ•´ç†ç³»çµ±</h1>
      <p class="text-gray-600">ä½¿ç”¨æœ¬åœ° LM Studio æ¨¡å‹è‡ªå‹•æ•´ç†é›œäº‚è³‡æ–™</p>
      <div class="mt-4">
        <button onclick="testConnection()" class="text-sm bg-blue-100 text-blue-800 px-4 py-2 rounded">
          æ¸¬è©¦ LM Studio é€£æ¥
        </button>
        <span id="connectionStatus" class="ml-3 text-sm"></span>
      </div>
    </header>

    <!-- æ­¥é©Ÿ 1: è¼¸å…¥è³‡æ–™ -->
    <section class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-2xl font-bold mb-4">ğŸ“ æ­¥é©Ÿ 1: è¼¸å…¥é›œäº‚è³‡æ–™</h2>
      
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">æ•´ç†æ–¹å¼ï¼š</label>
        <select id="organizationType" class="border rounded px-3 py-2 w-64">
          <option value="é‚è¼¯é¡åˆ¥">æŒ‰é‚è¼¯é¡åˆ¥</option>
          <option value="åŠŸèƒ½æ¨¡å¡Š">æŒ‰åŠŸèƒ½æ¨¡å¡Š</option>
          <option value="å„ªå…ˆç´š">æŒ‰å„ªå…ˆç´š</option>
          <option value="æ™‚é–“é †åº">æŒ‰æ™‚é–“é †åº</option>
          <option value="ä¸»é¡Œ">æŒ‰ä¸»é¡Œ</option>
        </select>
      </div>

      <textarea 
        id="rawDataInput" 
        class="w-full h-64 border rounded p-4 font-mono text-sm"
        placeholder="åœ¨æ­¤ç²˜è²¼æˆ–è¼¸å…¥é›œäº‚çš„è³‡æ–™...

ä¾‹å¦‚ï¼š
- ç”¢å“æè¿°æ–‡æœ¬
- ä»£ç¢¼ç‰‡æ®µ
- åŠŸèƒ½éœ€æ±‚åˆ—è¡¨
- æ··é›œçš„ç­†è¨˜
- ä»»ä½•éœ€è¦æ•´ç†çš„æ–‡æœ¬æ•¸æ“š

AI æœƒè‡ªå‹•åˆ†æä¸¦åˆ†é¡æ•´ç†ã€‚"></textarea>

      <div class="mt-4 flex gap-3">
        <button 
          onclick="organizeData()" 
          class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700">
          ğŸš€ é–‹å§‹ AI æ•´ç†
        </button>
        <button 
          onclick="loadExample()" 
          class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300">
          åŠ è¼‰ç¤ºä¾‹æ•¸æ“š
        </button>
      </div>

      <div id="processingStatus" class="mt-4 hidden">
        <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
          <p class="text-yellow-800">â³ AI æ­£åœ¨åˆ†æå’Œæ•´ç†è³‡æ–™ï¼Œè«‹ç¨å€™...</p>
        </div>
      </div>
    </section>

    <!-- æ­¥é©Ÿ 2: æŸ¥çœ‹æ•´ç†çµæœ -->
    <section id="resultsSection" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
      <h2 class="text-2xl font-bold mb-4">âœ… æ­¥é©Ÿ 2: æŸ¥çœ‹æ•´ç†çµæœ</h2>
      
      <div id="resultsSummary" class="bg-green-50 border border-green-200 rounded p-4 mb-6"></div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- åˆ†é¡åˆ—è¡¨ -->
        <div class="lg:col-span-1">
          <h3 class="font-bold mb-3">ğŸ“‚ åˆ†é¡</h3>
          <div id="categoriesList" class="space-y-2"></div>
        </div>

        <!-- æ•¸æ“šé …ç›® -->
        <div class="lg:col-span-2">
          <h3 class="font-bold mb-3">ğŸ“„ æ•´ç†å¾Œçš„æ•¸æ“š</h3>
          <div id="itemsList" class="space-y-3"></div>
        </div>
      </div>
    </section>

    <!-- æ­¥é©Ÿ 3: å°å‡ºä»£ç¢¼ -->
    <section id="exportSection" class="bg-white rounded-lg shadow p-6 hidden">
      <h2 class="text-2xl font-bold mb-4">ğŸ“¦ æ­¥é©Ÿ 3: å°å‡ºæ•´é½Šä»£ç¢¼</h2>
      
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">å°å‡ºæ ¼å¼ï¼š</label>
        <div class="flex gap-3">
          <button onclick="exportData('typescript')" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
            TypeScript (.ts)
          </button>
          <button onclick="exportData('constants')" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
            Constants (.ts)
          </button>
          <button onclick="exportData('json')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            JSON (.json)
          </button>
        </div>
      </div>

      <div id="exportPreview" class="mt-4 hidden">
        <h3 class="font-medium mb-2">é è¦½ï¼š</h3>
        <pre class="bg-gray-900 text-gray-100 p-4 rounded overflow-x-auto text-sm"><code id="exportCode"></code></pre>
        <button onclick="copyToClipboard()" class="mt-3 bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">
          ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼æ¿
        </button>
      </div>
    </section>
  </div>

  <script>
    const API_BASE = 'http://localhost:3001/api';
    let currentData = null;

    async function testConnection() {
      const status = document.getElementById('connectionStatus');
      status.textContent = 'æ¸¬è©¦ä¸­...';
      status.className = 'ml-3 text-sm text-yellow-600';

      try {
        const res = await fetch(`${API_BASE}/test-lm-studio`);
        const data = await res.json();
        
        if (data.success) {
          status.textContent = 'âœ… LM Studio é€£æ¥æ­£å¸¸';
          status.className = 'ml-3 text-sm text-green-600';
        } else {
          throw new Error(data.error);
        }
      } catch (error) {
        status.textContent = 'âŒ ç„¡æ³•é€£æ¥ LM Studio';
        status.className = 'ml-3 text-sm text-red-600';
        alert('è«‹ç¢ºä¿ LM Studio å·²å•Ÿå‹•ä¸¦é‹è¡Œåœ¨ localhost:1234');
      }
    }

    async function organizeData() {
      const rawData = document.getElementById('rawDataInput').value.trim();
      const organizationType = document.getElementById('organizationType').value;

      if (!rawData) {
        alert('è«‹è¼¸å…¥éœ€è¦æ•´ç†çš„è³‡æ–™');
        return;
      }

      document.getElementById('processingStatus').classList.remove('hidden');

      try {
        const res = await fetch(`${API_BASE}/organize`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rawData, organizationType })
        });

        const result = await res.json();

        if (result.success) {
          currentData = result.data;
          displayResults(result.data, result.message);
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        alert('æ•´ç†å¤±æ•—: ' + error.message);
      } finally {
        document.getElementById('processingStatus').classList.add('hidden');
      }
    }

    function displayResults(data, message) {
      // é¡¯ç¤ºçµæœå€åŸŸ
      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('exportSection').classList.remove('hidden');

      // æ‘˜è¦
      document.getElementById('resultsSummary').innerHTML = `
        <p class="text-green-800 font-medium">${message}</p>
        <p class="text-sm text-gray-600 mt-2">æœ€å¾Œæ›´æ–°: ${new Date(data.lastUpdated).toLocaleString('zh-TW')}</p>
      `;

      // åˆ†é¡åˆ—è¡¨
      const categoriesList = document.getElementById('categoriesList');
      categoriesList.innerHTML = data.categories.map(cat => `
        <div class="border rounded p-3 bg-blue-50">
          <div class="font-medium text-blue-900">${cat.name}</div>
          <div class="text-xs text-gray-600 mt-1">${cat.description || ''}</div>
          <div class="text-xs text-gray-500 mt-1">
            ${data.items.filter(item => item.categoryId === cat.id).length} é …
          </div>
        </div>
      `).join('');

      // æ•¸æ“šé …ç›®
      const itemsList = document.getElementById('itemsList');
      itemsList.innerHTML = data.items.map(item => {
        const category = data.categories.find(c => c.id === item.categoryId);
        return `
          <div class="border rounded p-4 hover:bg-gray-50">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <span class="inline-block px-2 py-1 text-xs rounded bg-blue-100 text-blue-800 mb-2">
                  ${category?.name || 'æœªåˆ†é¡'}
                </span>
                <p class="text-gray-900">${item.content}</p>
                ${item.originalText && item.originalText !== item.content ? `
                  <details class="mt-2">
                    <summary class="text-xs text-gray-500 cursor-pointer">åŸå§‹æ–‡æœ¬</summary>
                    <p class="text-xs text-gray-600 mt-1 pl-4 border-l-2">${item.originalText}</p>
                  </details>
                ` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function exportData(format) {
      if (!currentData) return;

      try {
        const res = await fetch(`${API_BASE}/export`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ format })
        });

        const result = await res.json();

        if (result.success) {
          document.getElementById('exportPreview').classList.remove('hidden');
          document.getElementById('exportCode').textContent = result.content;
          alert(`âœ… å·²å°å‡ºç‚º ${result.filename}`);
        }
      } catch (error) {
        alert('å°å‡ºå¤±æ•—: ' + error.message);
      }
    }

    function copyToClipboard() {
      const code = document.getElementById('exportCode').textContent;
      navigator.clipboard.writeText(code);
      alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼æ¿');
    }

    function loadExample() {
      document.getElementById('rawDataInput').value = `
ç”¢å“åŠŸèƒ½åˆ—è¡¨ (æœªæ•´ç†):
- ç”¨æˆ¶å¯ä»¥é€šéé›»å­éƒµä»¶è¨»å†Š
- æ”¯æŒæ·±è‰²æ¨¡å¼åˆ‡æ›
- ç”¢å“åœ–ç‰‡éœ€è¦æ”¯æŒç¸®æ”¾åŠŸèƒ½
- è³¼ç‰©è»Šè¦èƒ½ä¿å­˜ 7 å¤©
- Bug: åœ¨ Safari ä¸Šä»˜æ¬¾æŒ‰éˆ•ä½ç½®åç§»
- éœ€è¦æ·»åŠ å¤šèªè¨€æ”¯æŒ (ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡)
- ç®¡ç†å“¡éœ€è¦æŸ¥çœ‹éŠ·å”®çµ±è¨ˆ
- ç”¢å“è©³æƒ…é åŠ è¼‰å¤ªæ…¢ï¼Œéœ€è¦å„ªåŒ–
- ç§»å‹•ç«¯çš„å°èˆªèœå–®éœ€è¦é‡æ–°è¨­è¨ˆ
- ç”¨æˆ¶åé¥‹: çµè³¬æµç¨‹å¤ªè¤‡é›œ
- è¦å¯¦ç¾å¯¦æ™‚åº«å­˜æ›´æ–°
- SEO: ç”¢å“é é¢éœ€è¦æ›´å¥½çš„ meta æè¿°
- å®‰å…¨æ€§: éœ€è¦æ·»åŠ  CSRF ä¿è­·
- å®¢æœèŠå¤©åŠŸèƒ½ (å„ªå…ˆç´š: é«˜)
- é›»å­éƒµä»¶é€šçŸ¥ç³»çµ±é‚„æ²’åš
      `.trim();
    }

    // é é¢åŠ è¼‰æ™‚æ¸¬è©¦é€£æ¥
    window.addEventListener('load', testConnection);
  </script>
</body>
</html>
